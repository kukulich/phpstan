#!/usr/bin/env php
<?php declare(strict_types=1);

use PHPStan\Command\AnalyseCommand;

gc_disable(); // performance boost

$composerAutoloadFile = getcwd() . '/vendor/autoload.php';
if (!is_file($composerAutoloadFile)) {
	$composerAutoloadFile = __DIR__ . '/../vendor/autoload.php';
	if (!is_file($composerAutoloadFile)) {
		$composerAutoloadFile = __DIR__ . '/../../../autoload.php';
	}
}

if (!is_file($composerAutoloadFile)) {
	// Todo
}

$composerClassLoader = require_once $composerAutoloadFile;
$composerClassLoader->addClassMap([\Composer\Autoload\ClassLoader::class => dirname($composerAutoloadFile) . '/composer/ClassLoader.php']);

$version = 'Version unknown';
try {
	$version = \Jean85\PrettyVersions::getVersion('phpstan/phpstan')->getPrettyVersion();
} catch (\OutOfBoundsException $e) {

}

$application = new \Symfony\Component\Console\Application(
	'PHPStan - PHP Static Analysis Tool',
	$version
);
$application->setCatchExceptions(false);
$application->add(new AnalyseCommand($composerClassLoader));
$application->run();
